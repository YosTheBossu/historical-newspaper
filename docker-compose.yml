services:
  # Production: all-in-one container (nginx + node + cron)
  newspaper:
    build: .
    container_name: historical-newspaper
    restart: unless-stopped
    ports:
      - "${APP_PORT:-8080}:80"
    environment:
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}

  # Manual data collection (run with: docker compose --profile collect run --rm collector)
  collector:
    image: node:20-alpine
    container_name: newspaper-collector
    working_dir: /app
    volumes:
      - ./:/app
    environment:
      - DEEPSEEK_API_KEY=${DEEPSEEK_API_KEY}
    command: node data-collector.js
    profiles:
      - collect
